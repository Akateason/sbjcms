<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>内容列表</title>
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <style>
        .searchInfoContainer{
            margin-bottom: 20px;
        }
        .searchInfoContainer:nth-child(2){
            border-bottom: 1px solid #ddd;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
<div class="searchInfoContainer form-inline">
    <select name="searchType" id="searchType" class="form-control">
        <option value="1">标题</option>
        <option value="2">标签</option>
    </select>
    <input type="text" name="searchIpt" id="searchIpt" class="form-control">
    <a href="javascript:searchData();" id="searchBtn" class="btn btn-primary">Search</a>
</div>
<div class="searchInfoContainer">
    <span>类别:</span>
        <#list kinds as kind>
            <a href="javascript:searchData(${kind.kindId});">${kind.name}</a>
        </#list>
</div>
<a href="/content/addH" style="margin-bottom: 20px;display: block;">添加新内容</a>
<a href="javascript:getPageData(-1)" class="btn prePage">上一页</a>
<a href="javascript:getPageData(1)" class="btn nextPage">下一页</a>
<table id="contetListContainer" class="table table-striped table-bordered">

</table>
<a href="/content/addH">添加新内容</a>
<a href="javascript:getPageData(-1)" class="btn prePage">上一页</a>
<a href="javascript:getPageData(1)" class="btn nextPage">下一页</a>

<script src="${ctx}/scripts/jquery-1.8.3.min.js"></script>
<script src="${ctx}/scripts/react.js"></script>
<script src="${ctx}/scripts/JSXTransformer.js"></script>

<script type="text/jsx">
    var currentP=1;
    var MyList=React.createClass({
        render:function(){
            var flist=this.props.data.map(function(content){
                var modifyLink="content/updateH?id="+content.contentId;
                return(
                        <tr>
                            <td>{content.contentId}</td>
                            <td>{content.title}</td>
                            <td>{content.kindName}</td>
                            <td><input type="checkbox" name="" id="" checked={content.isTop} disabled="disabled" /></td>
                            <td><input type="checkbox" name="" id="" checked={content.isRecommend} disabled="disabled" /></td>
                            <td><input type="checkbox" name="" id="" checked={content.isSlide} disabled="disabled" /></td>
                            <td><a href={modifyLink}>修改</a> <a href="javascript:;" className="delContent" alt={content.contentId}>删除</a></td>
                        </tr>
                )
            })
            return(
                    <tbody>
                        {flist}
                    </tbody>
            )
        }
    })
    var myCompent;
    function getData() {
        $.ajax("/content/list",{
            success:function(data){
                console.log(data);
                myCompent=React.render(
                        React.createElement(MyList,{"data":data.returnData.list}),
                        document.getElementById("contetListContainer"),
                        function(){
                            $("#contetListContainer").prepend("<thead><tr><th>ID</th><th>标题</th><th>类别</th><th>置顶</th><th>推荐</th><th>幻灯片</th><th>操作</th></tr></thead>")
                        }
                )
            }
        })
    }

    $("#searchIpt").keyup(function(e){
        if(e.keyCode==13){
            searchData();
        }
    })

    function searchData(kindId){
        var searchType,searchIpt;
        if(kindId!=undefined){
            searchType="searchByKind";
            searchIpt=kindId;
        }else {
            searchType = $("#searchType").val() == "1" ? "searchByTitle" : "searchByTag";
            searchIpt = $("#searchIpt").val();
        }
        if(searchIpt.length==0){
            alert("搜索内容不能为空");
            return false;
        }
        $.ajax("/content/"+searchType,{
            data:{keyword:searchIpt},
            success:function(data){
                myCompent.setProps({"data":data.returnData.list});
            }
        })
    }

    function getPageData(n){
        if(n==1){
            currentP++;
            $(".prePage").removeClass("disabled");
        }else{
            currentP--;
            $(".nextPage").removeClass("disabled");
            if(currentP==1){
                $(".prePage").addClass("disabled");
            }
        }
        $.ajax("/content/list",{
            data:{page:currentP},
            success:function(data){
                if(data.returnData.list.length>0) {
                    myCompent.setProps({"data": data.returnData.list});
                }else{
                    $(".nextPage").addClass("disabled");
                    currentP--;
                    alert("到底了");
                }
            }
        })
    }

    $("#contetListContainer").delegate(".delContent","click",function(){
        var that=$(this).closest("tr");
        var id=$(this).attr("alt");
        $.ajax("/content/del",{
            data:{contentId:id},
            success:function(data){
                if(data.returnCode=="1001"){
                    that.fadeOut();
                }
                else{
                    alert(data.returnMsg);
                }
            }
        })
    })
    getData();
</script>
</body>
</html>